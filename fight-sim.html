<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fight Simulator - Whipper Wiki</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
  <link rel="stylesheet" href="css/style.css">
  <style>
    .sim-grid { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
    @media (max-width:900px) { .sim-grid { grid-template-columns:1fr; } }
    .sim-section { background:var(--bg-card); border:1px solid var(--border-subtle); border-radius:var(--radius-lg); overflow:hidden; }
    .section-header { background:var(--accent-gold); color:var(--bg-dark); padding:0.75rem 1rem; font-weight:600; font-family:var(--font-heading); text-transform:uppercase; letter-spacing:0.05em; font-size:0.9rem; }
    .section-body { padding:1.5rem; }
    .form-group { margin-bottom:1rem; }
    .form-group label { display:block; margin-bottom:0.5rem; color:var(--text-secondary); font-size:0.85rem; }
    .form-group select, .form-group input { width:100%; padding:0.625rem; background:var(--bg-input); border:1px solid var(--border-subtle); border-radius:var(--radius-sm); color:var(--text-primary); font-size:0.9rem; }
    .form-group select:focus, .form-group input:focus { outline:none; border-color:var(--accent-gold); }
    .form-row { display:flex; gap:1rem; }
    .form-row .form-group { flex:1; }
    .key-input-row { display:flex; gap:0.5rem; }
    .key-input-row input { flex:1; }
    .key-input-row button { white-space:nowrap; }
    .key-info-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:0.5rem; padding:1rem; background:var(--bg-surface); border-radius:var(--radius-sm); font-size:0.85rem; }
    .run-btn { width:100%; padding:1rem; font-size:1.1rem; margin-top:1rem; }
    .results-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:1rem; margin-bottom:1.5rem; }
    @media (max-width:600px) { .results-grid { grid-template-columns:repeat(2,1fr); } }
    .result-item { text-align:center; padding:1rem; background:var(--bg-surface); border-radius:var(--radius-md); }
    .result-value { font-size:1.5rem; font-weight:700; color:var(--accent-gold); }
    .result-value.text-positive { color:#4ade80; }
    .result-value.text-negative { color:#ff6b6b; }
    .result-label { font-size:0.75rem; color:var(--text-secondary); text-transform:uppercase; margin-top:0.25rem; }

    .build-preview { background:var(--bg-surface); border-radius:var(--radius-sm); padding:0.75rem; margin-top:0.75rem; font-size:0.8rem; }
    .build-preview .bp-row { display:flex; justify-content:space-between; padding:0.2rem 0; }
    .build-preview .bp-label { color:var(--text-secondary); }
    .build-preview .bp-val { color:var(--text-primary); font-weight:500; }
    .build-preview .bp-val.gold { color:var(--accent-gold); }

    .floor-log { max-height:400px; overflow-y:auto; font-size:0.8rem; }
    .floor-row { display:grid; grid-template-columns:40px 1fr 60px 60px 80px; gap:0.5rem; padding:0.4rem 0.5rem; border-bottom:1px solid var(--border-subtle); align-items:center; }
    .floor-row:hover { background:var(--bg-card-hover); }
    .floor-row.win { }
    .floor-row.loss { background:rgba(255,107,107,0.05); }
    .floor-row .fl { color:var(--text-secondary); font-weight:600; }
    .floor-row .monster-name { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .floor-row .turns { color:var(--text-secondary); }
    .floor-row .hp-left { font-weight:500; }
    .floor-row .outcome { font-weight:600; }
    .floor-row .outcome.w { color:#4ade80; }
    .floor-row .outcome.l { color:#ff6b6b; }

    .text-positive { color:#4ade80; }
    .text-negative { color:#ff6b6b; }
    .text-muted a { color:var(--accent-gold); }
  </style>
</head>
<body>
  <div id="wiki-header"></div>
  <main class="main">
    <div class="container">
      <header class="page-header">
        <h1>Fight Simulator (WIP)</h1>
        <p>Test your builds against dungeons. Uses builds from the Build Maker. Player always starts at Lv 1.</p>
      </header>
      <div class="sim-grid">
        <div>
          <div class="sim-section">
            <div class="section-header">Build Selection</div>
            <div class="section-body">
              <div class="form-group">
                <label>Select Saved Build</label>
                <select id="build-select"></select>
              </div>
              <div id="build-preview" class="build-preview" style="display:none;"></div>
              <p class="text-muted" style="font-size:0.8rem;margin-top:0.75rem;">Create builds in the <a href="build-maker.html">Build Maker</a> tool.</p>
            </div>
          </div>

          <div class="sim-section" style="margin-top:1rem;">
            <div class="section-header">Dungeon Selection</div>
            <div class="section-body">
              <div class="form-group">
                <label>Dungeon Type</label>
                <select id="dungeon-type">
                  <option value="story">Story Dungeon</option>
                  <option value="random">Random Dungeon (Key)</option>
                </select>
              </div>
              <div id="story-dungeon-group" class="form-group">
                <label>Story Dungeon</label>
                <select id="story-dungeon"></select>
              </div>
              <div id="random-dungeon-group" style="display:none;">
                <div class="form-group">
                  <label>Dungeon Key</label>
                  <div class="key-input-row">
                    <input type="text" id="dungeon-key" placeholder="Enter key...">
                    <button id="parse-key-btn" class="btn btn-primary">Parse</button>
                  </div>
                </div>
                <div id="key-info"><span class="text-muted">Enter a key and click Parse.</span></div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Miasma Level</label>
                  <input type="number" id="miasma-level" value="50" min="0" max="100">
                </div>
                <div class="form-group">
                  <label>Simulation Runs</label>
                  <input type="number" id="num-runs" value="10" min="1" max="100">
                </div>
              </div>
              <button id="run-sim-btn" class="btn btn-primary run-btn">Run Simulation</button>
            </div>
          </div>
        </div>

        <div>
          <div class="sim-section">
            <div class="section-header">Results</div>
            <div class="section-body">
              <div id="sim-results"><p class="text-muted">Run a simulation to see results.</p></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <div id="wiki-footer"></div>
  <script src="js/helpers.js"></script>
  <script src="js/pages/fight-sim.js"></script>
</body>
</html>
